# Orchestration phases for daily-planning ritual
# The orchestrator reads this file to determine subagent execution

phases:
  # Phase 0: Setup (parallel, read-only)
  - name: setup
    parallel: true
    subagents:
      - skill: _sub/fetch-config
        type: explore
        output: VAULT
      - skill: _sub/fetch-dates
        type: explore
        args: "target={{ARGUMENTS}} scope=daily"
        output: DATES
      - skill: _sub/fetch-directives
        type: explore
        output: DIRECTIVES
        optional: true
        on_error: "Directives not found. Using defaults."

  # Phase 1: Gather Context (parallel, read-only)
  - name: gather
    depends_on: [setup]
    parallel: true
    subagents:
      - skill: _sub/fetch-calendar
        type: explore
        args: "scope={{DATES.target_date}} format=json"
        output: CALENDAR
        optional: true
        fallback: inline
        on_error: "Calendar unavailable. Add meetings manually."
      - skill: _sub/fetch-week-content
        type: explore
        output: WEEK
        optional: true
        on_error: "Week.md not found. Weekly context unavailable."
      - skill: _sub/fetch-month-content
        type: explore
        output: MONTH
        optional: true
        on_error: "Month.md not found. Monthly context unavailable."
      - skill: _sub/fetch-active-projects
        type: explore
        args: "filter=all"
        output: PROJECTS
        optional: true
        on_error: "No active projects found."
      - skill: _sub/fetch-today-content
        type: explore
        output: CURRENT_DAY
        optional: true
        on_error: "Current Today.md not found. Fresh day."
      - skill: _sub/fetch-quarter-content
        type: explore
        output: QUARTER
        optional: true
        on_error: "Quarter.md not found. Coaching context unavailable."

  # Phase 2: Pre-flight Check (inline)
  - name: preflight
    depends_on: [gather]
    inline: true

  # Phase 3: Interactive Planning (inline - requires user)
  - name: interact
    depends_on: [preflight]
    inline: true

  # Phase 4: Generate Plan (inline)
  - name: generate
    depends_on: [interact]
    inline: true

  # Phase 5: Write Output (write-capable subagent)
  - name: write
    depends_on: [generate]
    subagents:
      - skill: _sub/write-captive-note
        type: general-purpose
        args: "path={{VAULT}}/00_Brain/Captive/Today.md content={{PLAN}}"
        output: WRITE_RESULT
