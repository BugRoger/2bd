# Orchestration phases for archive-project command
# Interactive workflow for archiving completed projects with summary capture

phases:
  # Phase 0: Setup (parallel, read-only)
  - name: setup
    parallel: true
    subagents:
      - skill: _sub/fetch-config
        type: explore
        output: VAULT
      - skill: _sub/fetch-projects-vault
        type: explore
        args: "scope=active"
        output: PROJECTS
        optional: true
        on_error: "No active projects found to archive."

  # Phase 1: Select Project (inline - requires user)
  - name: select
    depends_on: [setup]
    inline: true
    description: |
      Present list of active projects from PROJECTS.
      If --args provided a slug, look up and confirm.
      Otherwise, show numbered list for user selection.
      Store selected project in PROJECT variable.

  # Phase 2: Interactive Summary (inline - requires user)
  - name: interact
    depends_on: [select]
    inline: true
    description: |
      Walk through 5 summary questions one at a time:
      1. Final Status (required) - completed/partial/cancelled/on-hold
      2. Key Wins (required) - bullet list of successes
      3. Key Learnings (required) - lessons learned
      4. Impact (required) - measurable outcomes
      5. Follow-ups (optional) - future actions

  # Phase 3: Generate Archive Data (inline)
  - name: generate
    depends_on: [interact]
    inline: true
    description: |
      Build archive data object from selection and summary responses.
      Include project metadata and full summary.
      Confirm with user before syncing.

  # Phase 4: Sync to Vault (required)
  - name: sync-vault
    depends_on: [generate]
    subagents:
      - skill: _sub/project-sync-vault
        type: general-purpose
        args: "action=archive vault={{VAULT}} project={{PROJECT}}"
        output: VAULT_RESULT

  # Phase 5: Sync to Finder (optional, disabled)
  - name: sync-finder
    depends_on: [sync-vault]
    enabled: false
    optional: true
    subagents:
      - skill: _sub/project-sync-finder
        type: general-purpose
        args: "action=archive project={{PROJECT}}"
        output: FINDER_RESULT
        optional: true
        on_error: "Finder sync skipped."

  # Phase 6: Sync to Outlook (optional, disabled)
  - name: sync-outlook
    depends_on: [sync-vault]
    enabled: false
    optional: true
    subagents:
      - skill: _sub/project-sync-outlook
        type: general-purpose
        args: "action=archive project={{PROJECT}}"
        output: OUTLOOK_RESULT
        optional: true
        on_error: "Outlook sync skipped."

  # Phase 7: Confirm and Summarize (inline)
  - name: confirm
    depends_on: [sync-vault, sync-finder, sync-outlook]
    inline: true
    description: |
      Present summary of archived artifacts:
      - Source and destination paths
      - Archive date
      - Full summary (status, wins, learnings, impact, follow-ups)
      - Next steps for the user
